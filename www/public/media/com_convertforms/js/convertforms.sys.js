jQuery(function(e){e.fn.awesomeEditor=function(t){var n=this,o=e.extend({plugin:"Convert Forms Editor",debug:!0,form:n.find(".nrEditorOptions #adminForm"),root:n.data("root"),GoogleFonts:ConvertFormsGoogleFonts},t),i=!1;function r(){tinyMCE.init({init_instance_callback:function(t){t.on("ExecCommand",function(){tinyMCE.triggerSave(),a()}),t.on("blur",function(){tinyMCE.triggerSave(),a()}),"jform_text"==t.id&&e("#jform_bgcolor").change(function(){t.getBody().style.backgroundColor=e(this).val()}).trigger("change"),"jform_footer"==t.id&&e("#jform_formbgcolor").change(function(){t.getBody().style.backgroundColor=e(this).val()}).trigger("change")},content_css:o.root+"/templates/system/css/editor.css",document_base_url:o.root,height:"170",plugins:"textcolor, code, colorpicker, fullscreen, link, image",selector:".editorx",toolbar1:"fontsizeselect styleselect link unlink image mybutton",toolbar2:"forecolor | bold italic underline | alignleft aligncenter alignright | code fullscreen",fontsize_formats:"10px 11px 12px 14px 16px 18px 20px 22px 24px 26px 28px 30px 32px 34px 36px 38px 40px 42px 46px 48px 50px 52px",mode:"specific_textareas",entity_encoding:"raw",forced_root_block:"",toolbar_items_size:"small",statusbar:!1,menubar:!1,inline_styles:!0,force_br_newlines:!1,relative_urls:!1,remove_script_host:!1,paste_data_images:!0,importcss_append:!0,image_advtab:!0})}function a(t){i||(formData=o.form.find("select, input[name*=jform], textarea").serialize(),e.ajax({type:"POST",url:o.root+"administrator/index.php?option=com_convertforms&view=form&layout=preview&format=raw",data:formData,success:function(n){l("AJAX Request: Success"),t?e(".nrEditorPreviewContainer").hide().html(n).fadeIn():e(".nrEditorPreviewContainer").html(n),e("#preview-loader, #preview-successmsg").trigger("change")},beforeSend:function(){l("AJAX Request: Start"),i=!0,e(".loader").fadeIn()},complete:function(){i=!1,e(".loader").fadeOut()},error:function(e,t,n){c(n)}}))}function d(t){e("link[href='"+t+"']").length?l("Stylesheet "+t+" is already loaded"):(l("Loading stylesheet "+t),e("head").append(e('<link rel="stylesheet" type="text/css" />').attr("href",t)))}function s(){l("Resizing Container"),heights=[".navbar","header"];var t=0;heights.each(function(n){t+=e(n).outerHeight()}),height=e(window).height()-t,n.height(height+1)}function l(e){o.debug&&console.log("["+o.plugin+"] "+e)}function c(e){Joomla.renderMessages({error:[e]})}return d(o.root+"/media/com_convertforms/css/convertforms.css"),s(),e(".accordion-toggle").addClass("collapsed"),n.on("renderForm",function(){a()}),n.on("error",function(e,t){c(t)}),e(document).on("click",".cf-control-group",function(){key=e(this).data("key"),n.trigger("controlGroupClick",[key])}),e("#toolbar").appendTo(e(".nrEditorTools .r")),e(document).on("change",".nrEditorOptions input, .nrEditorOptions select, .nrEditorOptions textarea",function(t){var n;($el=e(t.target),$el.hasClass("norender"))||(isColorPicker=$el.hasClass("minicolors-input"),isColorPicker?(n=0,function(e,t){clearTimeout(n),n=setTimeout(e,t)})(function(){a()},100):a())}),e(document).on("subform-row-add subform-row-remove nrChoicesUpdate",function(){setTimeout(function(){a()},50)}),e(document).on("subform-row-add",function(){r()}),e(document).on("submit",".cf form",function(){return!1}),e(window).resize(function(){s()}),e(window).load(function(){r(),e("select.nrfont").change(function(){var t;t=e(this).val(),o.GoogleFonts.indexOf(t)>-1&&d("//fonts.googleapis.com/css?family="+encodeURIComponent(t))}).trigger("change"),a(!0)}),e("#toolbar-refresh .btn").removeAttr("onclick"),e("#toolbar-refresh").click(function(e){return e.preventDefault(),a(),!1}),e("#preview-loader").change(function(){e(this).is(":checked")?(e("#preview-successmsg").removeAttr("checked").trigger("change"),e(".nrEditorPreview .cf").addClass("cf-working")):e(".nrEditorPreview .cf").removeClass("cf-working")}),e("#preview-successmsg").change(function(){box=e(".nrEditorPreview .cf"),e(this).is(":checked")?(successMessage=e("#jform_successmsg").val(),box.find(".cf-response").html(successMessage),box.addClass("cf-success"),e("#jform_hideform0").is(":checked")?box.addClass("cf-success-hideform"):box.removeClass("cf-success-hideform")):box.removeClass("cf-success cf-error")}),this}}),jQuery(function(e){editor=e(".nrEditor"),editor.length&&editor.awesomeEditor()}),jQuery(function(e){e(document).on("click",".cf-layout-btn",function(){var t=e(this);container=t.closest(".control-group").find(".cf-layout-classes"),isVisible=container.is(":visible"),container.slideToggle(),t.text(isVisible?t.data("show-label"):t.data("hide-label"))}),e(document).on("click",".cf-layout-classes .cf-layout > span",function(){var t=e(this).closest(".control-group").find("input");value=e.trim(t.val()),css_class=e(this).attr("class"),value=value.length>0?value+" ":value,t.val(value+css_class).trigger("change"),e(".cf-layout-btn").trigger("click")})}),jQuery(function(e){var t=e(".fm");function n(n){running||(running=!0,isCopy=void 0!==n.copyfield,t.addClass("disabled"),e.ajax({type:"POST",url:$builder.attr("data-root")+"/administrator/index.php?option=com_convertforms&view=form&layout=field&format=raw",data:n,success:function(o){isCopy?t.find(".fmItems .fmItem[data-key="+n.copyfield+"]").after(o):t.find(".fmItems").append(o),$response=e(o),fieldKey=$response.attr("data-key"),fieldLabel=$response.find("h3").first().children().remove().end().text(),$field=t.find(".fmAddedFields .item:last-child").clone().attr("data-key",fieldKey).find(".fmFieldLabel strong").html(fieldLabel).end().find(".fmFieldLabel small").html("(ID: "+fieldKey+")").end(),isCopy?$field.insertAfter(".fmAddedFields .item[data-key="+n.copyfield+"]"):$field.appendTo(".fmAddedFields"),t.trigger("afterAddField",[t.attr("data-nextid")]).trigger("update")},error:function(e,t,n){$builder.trigger("error",n)},complete:function(){running=!1,t.removeClass("disabled")}}))}function o(e){$builder.find("#sectionsTabs li a[href=#fields]").trigger("click"),i("fmItems"),t.find(".fmItem").hide().filter("[data-key="+e+"]").show(),t.trigger("afterShowField",[e])}function i(e){$tab.find('li a[href="#'+e+'"]').tab("show")}function r(e){return e=void 0===e?t.attr("data-nextid"):e,t.attr("data-formcontrol").replace("X",e)}$builder=e(".nrEditor"),$tab=e("#fieldsManagerTabs"),running=!1,function(){if(el=e(".fmAddedFields"),0==el.length)return;el.sortable({update:function(n,o){$wrapper=t.find(".fmItems"),$wrapper.find(".fmItem").sort(function(t,n){return aIndex=e(".fmAddedFields .item[data-key="+e(t).attr("data-key")+"]").index(),bIndex=e(".fmAddedFields .item[data-key="+e(n).attr("data-key")+"]").index(),aIndex-bIndex}).appendTo($wrapper),t.trigger("update")}})}(),t.find(".addField").on("click",function(){if(void 0!==e(this).attr("data-pro-only"))return!1;var o=e(this).attr("data-type");n({field:{type:o,key:t.attr("data-nextid"),name:o+"_"+t.attr("data-nextid"),label:e.trim(e(this).text())},formcontrol:encodeURIComponent(r())})}),e(document).on("click",".fmAddedFields .item",function(){o(e(this).attr("data-key")),i("fmItems")}),e(document).on("click",".removeField",function(){var n,r=e(this);if(confirm("Are you sure")){var a=r.closest("div").attr("data-key");n=a,t.find(".fmAddedFields > .item[data-key="+n+"]").remove(),t.find(".fmItem[data-key="+n+"]").remove(),t.trigger("update"),r.data("focusnext")&&((a=t.find(".fmItems > .fmItem:first-child").attr("data-key"))?o(a):i("fmaddField"))}return!1}),e(document).on("click",".copyField",function(){return function(o){var i=t.find(".fmItems > .fmItem[data-key="+o+"]");field_type=i.find("input[id$=_type]").val(),field_data=i.find("input, select, textarea"),formControl=r(o);var a={};e.map(field_data.serializeArray(),function(e,n){var o=e.name.replace(formControl,"field"),i=e.value;"field[name]"==o&&(i+="_copy"),"field[key]"==o&&(i=t.attr("data-nextid")),a[o]=i}),a.formcontrol=encodeURIComponent(r()),a.copyfield=o,n(a)}(e(this).closest("div").attr("data-key")),!1}),t.on("update",function(){$builder.trigger("renderForm")}),t.on("afterAddField",function(){key=parseInt(t.attr("data-nextid")),o(key),t.find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"}),e(document).trigger("subform-row-add"),key+=1,t.attr("data-nextid",key)}),t.on("afterShowField",function(e,t){$builder.find(".cf-control-group").removeClass("active").filter("[data-key="+t+"]").addClass("active")}),$builder.on("controlGroupClick",function(e,t){o(t)})}),jQuery(function(e){var t=e(".st");e(".fm").on("update",function(){t.trigger("update")}),e(document).on("subform-row-add",function(){t.trigger("update")}),e(document).on("smartTagsBoxBeforeRender",function(t,n,o){var i=o.closest(".fmItem").length;if(skipFields=["jform_text","jform_footer"].indexOf(o.prev().attr("id"))>-1,skip=i||skipFields,!skip){var r={},a={Lead:{"{lead.id}":"Lead ID","{lead.date}":"Lead Date","{lead.campaign_id}":"Lead Campaign ID","{lead.form_id}":"Lead Form ID","{lead.visitor_id}":"Lead Visitor ID","{leads.count}":"Leads Count"}},d=e(".fmItems .fmItem");d.length&&(d.each(function(){var t=e(this),n=t.find("input[id$=__name]").val();if(!n)return!0;var o=t.find("input[id$=__label]").val();o||(o=e(".fmAddedFields .item[data-key="+t.data("key")+"]").find(".fmFieldLabel strong").text()),r[n="{field."+n+"}"]=o}),r["{all_fields}"]="All Fields",a.Fields=r,e.extend(!0,n,a))}})}),jQuery(function(e){var t=e(".nrEditor"),n="ConvertFormsState";function o(){if(state=function(){if($tabs=t.find(".nav-tabs"),0!=$tabs.children().length)return tab=$tabs.find("li.active a").attr("href").replace("#",""),panel=t.find(".tab-pane#"+tab+" .accordion-body.in.collapse"),panel.length?(panel=panel.parent().attr("class").split(" "),panel=panel[1]):panel="",tab+"-"+panel}(),void 0!=state){formID=t.find("form").attr("pk");try{Cookies.set(n+formID,state)}catch(e){console.log(e)}}}t.find(".accordion").on("shown.bs.collapse hidden.bs.collapse",function(){o()}),t.find(".nav-tabs").on("shown.bs.tab",function(){o()})});